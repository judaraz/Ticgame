<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Rich Ads -->
  <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
  <script>
    window.TelegramAdsController = new TelegramAdsController();
    window.TelegramAdsController.initialize({
      pubId: "956231",
      appId: "5476",
    });
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic Tac Toe Game</title>

  <!-- Telegram Web App -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#0a0a0a; overflow:hidden; color:white;}
    #intro { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; z-index:2000; background:#0a0a0a; transition:opacity 1s ease;}
    #intro h1 { font-size:3em; margin:0; color:#FFD700; text-shadow:2px 2px #000;}
    #intro h2 { font-size:2em; margin:5px 0; color:#00FFCC; text-shadow:2px 2px #000;}
    #intro h3 { font-size:1.5em; margin:5px 0; color:#FF4D6D; text-shadow:2px 2px #000;}
    #game-container { position:relative; width:100%; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:1;}
    #game { display:grid; grid-template-columns:repeat(3,100px); grid-gap:16px; margin-top:20px; }
    .cell { width:100px; height:100px; font-size:3em; border-radius:20px; background:linear-gradient(145deg,#5022aa,#2f0e63); display:flex; align-items:center; justify-content:center; cursor:pointer; }
    .cell.X { color:#00FFCC; text-shadow:0 0 8px #00FFCC; }
    .cell.O { color:#FF4D6D; text-shadow:0 0 8px #FF4D6D; }
    #status,#level,#points,#notification { margin:5px; font-size:18px; font-weight:bold;}
    #restart,#next,#reward-btn { margin:10px; padding:10px 20px; font-size:18px; border:none; border-radius:20px; cursor:pointer; }
    #restart{background:linear-gradient(to right,#ff416c,#ff4b2b); color:white;}
    #next{background:linear-gradient(to right,#ffb700,#ffd700); color:black;}
    #reward-btn{background:linear-gradient(to right,#00ffcc,#00bfff); color:black;}
    #result-overlay { position:fixed; top:40%; left:50%; transform:translate(-50%,-50%); font-size:2em; background:rgba(0,0,0,0.75); padding:20px 40px; border-radius:16px; display:none; z-index:1000; }
    .button-row { display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap; }
  </style>
</head>

<body>
  <div id="intro">
    <h1>Welcome</h1>
    <h2>Tic Tac Toe</h2>
    <h3>If you win you are Legend</h3>
  </div>

  <div id="game-container">
    <h2>Player vs Computer</h2>
    <div id="status">Your turn (X)</div>
    <div id="level">Level: 1 (Easy)</div>
    <div id="points">XP: 0</div>
    <div id="game"></div>

    <div class="button-row">
      <button id="restart">Restart</button>
      <button id="next">Next</button>
    </div>

    <button id="reward-btn">Watch Ads to Get Next Level</button>
  </div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const game = document.getElementById("game");
const restartBtn = document.getElementById("restart");
const nextBtn = document.getElementById("next");
const rewardBtn = document.getElementById("reward-btn");
const intro = document.getElementById("intro");

let board = Array(9).fill("");
let gameActive = true;
let gameFinished = false;

const wins = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

function showRichAd() {
  try {
    TelegramAdsController.show();
  } catch (e) {
    console.log("Rich ad not available");
  }
}

function createBoard(){
  game.innerHTML="";
  for(let i=0;i<9;i++){
    const cell=document.createElement("div");
    cell.className="cell";
    cell.onclick=()=>playerMove(i);
    game.appendChild(cell);
  }
}

function updateBoard(){
  [...game.children].forEach((c,i)=>{
    c.textContent = board[i];
    c.classList.remove("X","O");
    if(board[i]) c.classList.add(board[i]);
  });
}

function checkWin(p){ return wins.some(w=>w.every(i=>board[i]===p)); }
function isDraw(){ return board.every(v=>v); }

function playerMove(i){
  if(!gameActive || board[i]) return;
  board[i]="X"; updateBoard();
  if(checkWin("X")){ endGame("You Win!"); return; }
  if(isDraw()){ endGame("Draw!"); return; }
  setTimeout(computerMove,500);
}

function computerMove(){
  const empty = board.map((v,i)=>v?null:i).filter(v=>v!==null);
  const m = empty[Math.floor(Math.random()*empty.length)];
  board[m]="O"; updateBoard();
  if(checkWin("O")) endGame("You Lose!");
}

function endGame(msg){
  alert(msg);
  gameActive=false;
  gameFinished=true;
}

function resetGame(){
  board.fill("");
  gameActive=true;
  gameFinished=false;
  updateBoard();
}

restartBtn.onclick = resetGame;

nextBtn.onclick = ()=>{
  if(gameFinished) showRichAd();
  resetGame();
};

rewardBtn.onclick = ()=>{
  showRichAd();
  resetGame();
};

setTimeout(()=>{
  intro.style.opacity="0";
  setTimeout(()=>{
    intro.style.display="none";
    createBoard();
    updateBoard();
  },1000);
},3000);
</script>
</body>
</html>
