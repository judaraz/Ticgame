<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Watch & Earn</title>

<!-- Telegram WebApp -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- TMA Rewarded Video SDK -->
<script src="https://js.onclckvd.com/in-stream-ad-admanager/tma.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,Roboto,sans-serif;}
body{
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#0a0a0a;
    color:#fff;
}
.panel{
    width:360px;
    background:#0c0c0c;
    border-radius:22px;
    padding:24px;
    box-shadow:0 25px 70px rgba(0,0,0,.7);
    text-align:center;
}
.title{
    font-size:22px;
    margin-bottom:18px;
    font-weight:700;
}
button{
    width:100%;
    padding:16px;
    font-size:16px;
    border-radius:16px;
    border:none;
    cursor:pointer;
    background:#00ffe0;
    color:#000;
    font-weight:700;
}
button:disabled{
    background:#444;
    color:#999;
    cursor:not-allowed;
}
.status{
    margin-top:14px;
    font-size:12px;
    color:#aaa;
}
</style>
</head>

<body>

<div class="panel">
    <div class="title">Watch & Earn</div>

    <button id="adBtn" onclick="playTmaAd()" disabled>
        Loading adâ€¦
    </button>

    <div class="status" id="status">Initializing ads</div>
</div>

<script>
/* ---------- Telegram ---------- */
Telegram.WebApp.ready();
Telegram.WebApp.expand();

/* ---------- TMA Init ---------- */
let showTmaAd = null;
let tmaReady = false;
let isPlaying = false;

const adBtn = document.getElementById("adBtn");
const statusEl = document.getElementById("status");

window.initCdTma?.({ id: 6105836 }) // âœ… YOUR REAL SPOT ID
  .then(show => {
    showTmaAd = show;
    tmaReady = true;
    adBtn.disabled = false;
    adBtn.innerText = "Watch Ad";
    statusEl.innerText = "Ad ready";
    console.log("TMA READY");
  })
  .catch(err => {
    statusEl.innerText = "Ads unavailable";
    console.log("TMA INIT ERROR", err);
  });

/* ---------- Play Ad ---------- */
function playTmaAd() {
  if (!tmaReady || !showTmaAd || isPlaying) return;

  isPlaying = true;
  adBtn.disabled = true;
  statusEl.innerText = "Playing adâ€¦";

  showTmaAd()
    .then(() => {
      console.log("TMA AD VIEWED");
      statusEl.innerText = "Reward granted";
      // ðŸ‘‰ reward user here
    })
    .catch(err => {
      console.log("TMA FAILED / NO FILL", err);
      statusEl.innerText = "No ad available, try later";
    })
    .finally(() => {
      isPlaying = false;
      adBtn.disabled = false;
      statusEl.innerText = "Ready";
    });
}
</script>

</body>
</html>
